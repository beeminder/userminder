<!DOCTYPE html>
<html>
<head>
<title>Rapportive</title>
<meta name="description" content="Beeminder admin tool">
<link id="favicon" rel="icon" href="https://glitch.com/edit/favicon-app.ico" type="image/x-icon">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="/style.css">
</head>

<body>

<header>
<h1>Beeminder Support Helper</h1>
</header>

<main>
<form class="raplet">
  <label>Your auth token</label>
  <input id="token" type="text">
  <label>Email address</label>
  <input id="email" type="text" placeholder="e.g., user@email.com">
  <button type="submit">Submit</button>
</form>
<section class="dossier">
<div id="userinfo"></div>
</section>
</main>

<footer>
  Some helpful Beeminder links:
  <a href="https://www.beeminder.com">Foo</a>, 
  <a href="">Bar</a>, 
  <a href="">Baz</a>
</footer>

<!-- Your web-app is https, so your scripts need to be too -->
<script src="https://code.jquery.com/jquery-2.2.1.min.js"
        integrity="sha256-gvQgAFzTH6trSrAWoH1iPo9Xc96QxSZ3feW6kem+O00="
        crossorigin="anonymous"></script>
<script src="/client.js"></script>


<h1>Backstory</h1>

<p>
We can query information about our users with URLs like
<code>https://www.beeminder.com/raplet?users[]=alice@foo.com</code>
which return JSON like so:

<pre>
[
  {
    username: "not_a_real_user",
    goals: [ "not_a_real_goal", "example", "foo", "bar" ],
    email: "support@beeminder.com",
    subscription: null,
    is_payer: false,
    pledged: 0,
    since: "2011/10",
    email_given: "alice@foo.com"
  }
]
</pre>
  
(It only returns real user info if you're logged in as an admin, but it's the same format as above either way.)
</p>
  
<p>
Our goal is to have this app monitor the clipboard (copy/paste) buffer of the operating system and whenever it contains an email address, make the above API call and display information about the Beeminder user.
</p>

<p>
That way, when we're doing Beeminder support we can keep this app running in another tab or on another screen and by doing control-c on any address, we'll immediately see in that other window all the things Beeminder can tell us about that user.
</p>

<h3>Setup</h3>
<ol>
<li>Install the
<a href="https://chrome.google.com/webstore/detail/clipboard-permission-mana/ipbhneeanpgkaleihlknhjiaamobkceh?hl=en">Clipboard Permission Manager</a>
Chrome extension</li>
<li>Click the red icon to the right of the address bar and check the box to allow "direct clipboard access" for userminder.glitch.me</li>
</ol>  

<hr>

And here's how we can access the contents of the system clipboard:
<ol>
<li>Copy something interesting to the clipboard</li>  
<li>Click the mouse in the text area below</li>
<li>In the browser console, execute this:<br><code>document.execCommand("paste")</code></li>
<li>NEXT TASK: make the contents of the system clipboard appear in that box automatically in real time</li>
</ol>
<textarea id="vt"></textarea>

<textarea name="hide" style="display:none;"></textarea>


<h1>Scratch notes</h1>

<pre>
I guess you have to first try to execute the execCommand thing before the 
Chrome extension will prompt you for permission to read the clipboard.
So we should just make it do that on page load so it will prompt you 
right away, which will simplify these instructions a lot!
(Though maybe you'll still have to notice the red icon and click it, so
not a very obvious prompt.)
</pre>

</body>
</html>
